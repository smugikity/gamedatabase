{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/list.css' %}" />

<!-- Modal -->
<div class="modal" id="viewModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
<div class="modal-dialog modal-lg modal-dialog-centered">
	<div class="modal-content">
		<div class="modal-body movie-card-container d-flex">
			<div class="image-container ">
				<div class="bg-image" style='background-image: url("https://m.media-amazon.com/images/M/MV5BMTQ1MjQwMTE5OF5BMl5BanBnXkFtZTgwNjk3MTcyMDE@._V1_SX300.jpg");'></div>
			</div>
			<div class="movie-info">
				<h2>Movie Details</h2>
				<div>
					<h1>Frozen</h1><small>Released Date: 27 Nov 2013</small>
				</div>
				<h4>Rating: 7.4 / 10</h4>
				<p>Fearless optimist Anna teams up with rugged mountain man Kristoff and his loyal reindeer Sven and sets off on an epic journey to find her sister Elsa, whose icy powers have trapped the kingdom of Arendelle in eternal winter. Encountering Everest-like conditions, mystical trolls and a hilarious snowman named Olaf, Anna and Kristoff battle the elemen</p>
				<div class="tags-container"><span>Animation</span><span>Adventure</span><span>Comedy</span></div>
			</div>
			

			{% comment %} <div className="movie-card-container">
				<div className="image-container">
					<div
						className="bg-image
						style='background-image: url("https://m.media-amazon.com/images/M/MV5BMTQ1MjQwMTE5OF5BMl5BanBnXkFtZTgwNjk3MTcyMDE@._V1_SX300.jpg");'
					></div>
				</div>
				<div className="movie-info">
					<h2>Movie Details</h2>
					<div>
						<h1>{Title}</h1>
						<small>Released Date: {Released}</small>
					</div>
					<h4>Rating: {imdbRating} / 10</h4>
					<p>{Plot && Plot.substr(0, 350)}</p>
					<div className="tags-container">
						{Genre && Genre.split(', ').map(g => <span>{g}</span>)}
					</div>
				</div>
			</div> {% endcomment %}
		</div>
	</div>
</div>
</div>

<script>
	$(document).ready(function(){
		max_page = {{ max_page }};
		col = document.getElementById('page-collections');
		previous = col.firstElementChild;
		first = col.children[1];
		next = col.lastElementChild;
		pageValue = document.getElementById('page-value');
		form = document.forms.listsort;
		current = Number(pageValue.value);
		previous.addEventListener('click',function() {goToPage(current-1);});
		first.addEventListener('click',function() {goToPage(1);});
		next.addEventListener('click',function() {goToPage(current+1);});
		if (max_page<6) {renderPage(2,max_page);} 
		else {
			if (current<4) {
				renderPage(2,4);
				renderEllipsis();
				renderPage(max_page,max_page);
			} else if (current>max_page-3) {
				renderEllipsis();
				renderPage(max_page-3,max_page);
			} else {
				renderEllipsis();
				renderPage(current-1,current+1);
				renderEllipsis();
				renderPage(max_page,max_page);
			}
		}
		if (current == 1) first.classList.add("active");
		function renderPage(start,end) {
			for (let i=start; i<=end; i++) {
				clone = first.cloneNode(true);
				clone.firstElementChild.textContent=i;
				if (i === current) {
					console.log(i);
					clone.classList.add("active");
				}
				clone.addEventListener('click',function() {
					goToPage(i);
				});
				col.insertBefore(clone,next);
			}
		}
		function renderEllipsis() {
			clone = first.cloneNode(true);
			clone.firstElementChild.textContent="..";
			col.insertBefore(clone,next);
		}
		function goToPage(page) {
			if (page<1 || page>max_page) {return;}
			pageValue.value = page;
			form.submit();
		}
	});	
	function viewCustomItem(custom,id) {
		$.ajax({
			url: '/view/'+custom+'/'+id,
			type: "GET",
			dataType: "json",
			success: (data) => {
			  console.log(data);
			},
			error: (error) => {
			  console.log(error);
			}
		  });
	}
</script>
<main class="container my-4">
<h3 class="my-4 border-bottom pb-1"><span class="text-muted">List of </span>{{custom}}</h3>
<form name="listsort" method="post">
{% csrf_token %}
<div class="bg-white rounded d-flex flex-wrap mt-5" id="header"> 
		<div class="d-flex align-items-center">
			<button class="btn btn-hide text-uppercase" type="submit" id="filter-btn"> 
				<span id="btn-txt">Sort</span> <span class="fa fa-angle-right" id="filter-angle"></span>
			</button>
		</div>
		<div class="d-flex align-items-center"> 
			{{ form.sort }}
		</div>
		<div class="d-inline-flex align-items-center">
			<div class="d-inline-flex" id="select2">
				Games:{{ form.n_per }}
			</div>
			<div class="font-weight-bold mx-1">from {{ count }}</div>
		</div>
		<!--hidden field for page-->
		<div><input type="hidden"  name="page" value="{{ cur_page }}" id="page-value"/></div>
		<div class="ml-auto mr-2">
			<div id="page-collections" class="pagination d-flex align-items-center">
				<div class="page-item"> 
					<button class="page-link btn" type="button" aria-label="Previous" id="page-previous"> <span aria-hidden="true" class="font-weight-bold">&lt;</span> <span class="sr-only">Previous</span> </button> 
				</div>
				<div class="page-item">
					<button class="page-link btn" type="button">1</button>
				</div>
				
				<div class="page-item"> 
					<button class="page-link btn" type="button" aria-label="Next" id="page-next"> <span aria-hidden="true" class="font-weight-bold">&gt;</span> <span class="sr-only">Next</span> </button> 
				</div>
			</div>
		</div>	
</div>
</form>

<div id="content" class="mx-0 my-3">
	<div class="row">
		{% if data %}
		{% for item in data %}
			<div class="col-lg-4 col-md-6 pt-2">
				<div class="card d-flex flex-column align-items-center" onclick='viewCustomItem("{{ custom }}",{{ item.id }});' data-toggle="modal" data-target="#viewModal">
					<div class="product-name">{{ item.title }}</div>
					<div class="card-img "> <img src="/media/{{item.image}}" alt=""> </div>
					{% comment %} <div class="card-body pt-4">
						<div class="d-flex align-items-center price">
						<div class="del mr-2"><span class="text-dark">5500 uah</span></div>
						<div class="font-weight-bold">4500 uah</div>
						</div>
					</div> {% endcomment %}
				</div>
			</div>
		{% endfor %}
		{% endif %}
	</div>
</div>
</main>


{% endblock %}